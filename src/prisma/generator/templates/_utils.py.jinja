{% set is_async = generator.config.interface == 'asyncio' %}
{% set recursive_types = generator.config.recursive_type_depth == -1 %}

{% if is_async %}
    {% set maybe_await = 'await ' %}
    {% set maybe_async_def = 'async def ' %}
{% else %}
    {% set maybe_await = '' %}
    {% set maybe_async_def = 'def ' %}
{% endif %}


{% macro sleep(duration) -%}
{% if is_async %}
await asyncio.sleep({{ duration }})
{% else %}
time.sleep({{ duration }})
{% endif %}
{%- endmacro %}

{% set operations = {
    'create': 'mutation',
    'delete': 'mutation',
    'update': 'mutation',
    'upsert': 'mutation',
    'query_raw': 'mutation',
    'create_many': 'mutation',
    'execute_raw': 'mutation',
    'delete_many': 'mutation',
    'update_many': 'mutation',

    'count': 'query',
    'group_by': 'query',
    'find_many': 'query',
    'find_first': 'query',
    'find_unique': 'query',
}
%}

{% set methods = {
    'create': 'createOne',
    'delete': 'deleteOne',
    'update': 'updateOne',
    'upsert': 'upsertOne',
    'query_raw': 'queryRaw',
    'create_many': 'createMany',
    'execute_raw': 'executeRaw',
    'delete_many': 'deleteMany',
    'update_many': 'updateMany',

    'count': 'aggregate',
    'group_by': 'groupBy',
    'find_many': 'findMany',
    'find_first': 'findFirst',
    'find_unique': 'findUnique',
}
%}

{% set active_provider = datasources[0].active_provider %}

{% macro query_methods(name, enable_non_recursive=True) %}
{% if recursive_types %}

    @classmethod
    def prisma(cls: Type[PrismaModelT]) -> 'actions.{{ name }}Actions[PrismaModelT]':
        from .client import get_client

        return actions.{{ name }}Actions[PrismaModelT](get_client(), cls)
{% else %}

    {% if enable_non_recursive %}
    @classmethod
    def prisma(cls) -> 'actions.{{ name }}Actions':
        from .client import get_client

        return actions.{{ name }}Actions(get_client(), cls)
    {% else %}
    # TODO: try out mypy on the latest version to see if this doesn't crash anymore
    @classmethod
    def prisma(cls) -> 'NoReturn':
        raise RuntimeError(
            'Querying has been disabled as it cannot be typed with mypy;\n'
            'You must switch to using fully recursive types to enable querying from this model\n'
            'https://prisma-client-py.readthedocs.io/en/stable/reference/limitations/#querying-from-partial-models'
        )
    {% endif %}

{% endif %}
{% endmacro %}
